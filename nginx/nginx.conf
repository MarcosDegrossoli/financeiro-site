# 1. Rota para o Frontend React (SPA)
# Servir arquivos estáticos a partir de /financeiro/
location /financeiro/ {
    # O 'alias' aponta para o destino da cópia no Dockerfile (/usr/share/nginx/html/financeiro)
    alias /usr/share/nginx/html/financeiro/;
    index index.html;
    
    # O try_files é crucial para roteamento do lado do cliente (SPA)
    # Garante que rotas como /financeiro/contas voltem para o index.html
    try_files $uri $uri/ /financeiro/index.html;
}

# 2. Proxy Reverso: Encaminha requisições de API para o Backend .NET
# Esta seção não mudou e continua roteando /api para a API na porta 8080.
location /api {
    # proxy_pass usa o nome do container da API e a porta interna (8080)
    proxy_pass http://financeiro_api_container:8080; 
    
    # Remove o prefixo /api antes de enviar para o backend
    rewrite /api/(.*) /$1 break; 
    
    # Configura headers
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}