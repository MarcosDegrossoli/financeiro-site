# 1. Rota principal: Servir o Frontend React
# Roteia todas as requisições não específicas para o index.html do React
# O try_files é crucial para roteamento do lado do cliente (SPA - Single Page Application)
location / {
    root /usr/share/nginx/html;
    index index.html;
    try_files $uri $uri/ /index.html;
}

# 2. Proxy Reverso: Encaminha requisições de API para o Backend .NET
# Se o caminho começar com /api, encaminha para o container da API
location /api {
    # proxy_pass usa o nome do container da API e a porta interna (8080)
    proxy_pass http://financeiro_api_container:8080; 
    
    # Remove o prefixo /api antes de enviar para o backend
    # Ex: /api/Contas se torna /Contas para o servidor .NET
    rewrite /api/(.*) /$1 break; 
    
    # Configura headers para o backend identificar a requisição
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}
